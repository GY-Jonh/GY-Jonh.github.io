<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>小球碰撞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        .out-div {
            width: 100%;
            height: 100%;
        }

        .ball {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
<div class="out-div">
</div>
<script>
    var nums = 31;
    var leftV = 5;
    var topV = 5;
    var outDiv = document.querySelector('.out-div');
    var balls = document.getElementsByClassName('ball');
    var maxLeft, maxTop;


    createballs();
    window.onresize = getMaxWH();
    move();

    function getMaxWH() {
        var ballW = balls[0].offsetWidth;
        var ballH = balls[0].offsetHeight;
        maxLeft = window.innerWidth - ballW;
        maxTop = window.innerHeight - ballH;
        return getMaxWH;
    }

    function createballs() {    //生成设置球体
        var frame = document.createDocumentFragment();
        for (var i = 0; i < nums; i++) {
            var node = document.createElement('div');
            node.innerHTML = '';
            node.className = 'ball';
            node.leftv = leftV * Math.random();
            node.topv = topV * Math.random();
            createColor(node);
            frame.appendChild(node);
        }
        outDiv.appendChild(frame);
    }


    function move() {
        (function run() {
            for (var i = 0; i < balls.length; i++) {//移动球体
                var ball = balls[i];
                var left = getStyle(ball, 'left') + ball.leftv;//球体水平移动一次的当前位置
                var top = getStyle(ball, 'top') + ball.topv;//球体垂直移动一次的当前位置

                if (left >= maxLeft || left <= 0) {
                    ball.leftv = -ball.leftv;
                    left = Math.max(left, 0);
                    left = Math.min(left, maxLeft);
                    createColor(ball);
                }
                if (top >= maxTop || top <= 0) {
                    ball.topv = -ball.topv;
                    top = Math.max(top, 0);
                    top = Math.min(top, maxTop);
                    createColor(ball);
                }
                ball.style.top = top + 'px';
                ball.style.left = left + 'px';
            }
            requestAnimationFrame(run);
        })();
    }


    function getStyle(obj, attr) {
        var style = window.getComputedStyle(obj)[attr] || obj.currentStyle(attr);
        return parseFloat(style);
        //return getComputedStyle(obj, attr) || obj.currentStyle[attr];
    }

    function createColor(dom) {
        var r = Math.floor(Math.random() * 256),
            g = Math.floor(Math.random() * 256),
            b = Math.floor(Math.random() * 256);
        dom.style.boxShadow = '0 0 45px 0px rgb(' + r + ',' + g + ',' + b + ') inset';

    }

</script>
</body>
</html>